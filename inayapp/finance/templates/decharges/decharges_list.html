{% extends "layout.html" %}
{% load static %}
{% load permissions_tags %}
{% block content %}
<div class="container my-2">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Décharges en cours</h2>
    <div>
      <a href="{% url 'decharge_create' %}" class="btn btn-success me-2">
        <i class="fas fa-plus"></i> Nouvelle Décharge
      </a>
      <a href="{% url 'decharge_settled' %}" class="btn btn-outline-primary">
        <i class="fas fa-check-circle"></i> Décharges Réglées
      </a>
    </div>
  </div>

  <!-- Statistiques rapides -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <h5>Médecins</h5>
          <h3>{{ total_medecin }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <h5>Employés</h5>
          <h3>{{ total_employe }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <h5>Autres</h5>
          <h3>{{ total_autre }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Onglets pour chaque type -->
  <ul class="nav nav-tabs mb-3" id="dechargesTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="medecin-tab" data-bs-toggle="tab" data-bs-target="#medecin" type="button" role="tab">
        <i class="fas fa-user-md"></i> Médecins ({{ total_medecin }})
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="employe-tab" data-bs-toggle="tab" data-bs-target="#employe" type="button" role="tab">
        <i class="fas fa-users"></i> Employés ({{ total_employe }})
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="autre-tab" data-bs-toggle="tab" data-bs-target="#autre" type="button" role="tab">
        <i class="fas fa-user"></i> Autres ({{ total_autre }})
      </button>
    </li>
  </ul>

  <div class="tab-content" id="dechargesTabsContent">
    <!-- Onglet Médecins -->
    <div class="tab-pane fade show active" id="medecin" role="tabpanel">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="fas fa-user-md"></i> Décharges des Médecins</h5>
        </div>
        <div class="card-body p-0">
          {% include 'decharges/decharge_table.html' with decharges=decharges_medecin table_id='medecinTable' show_type='medecin' %}
        </div>
      </div>
    </div>

    <!-- Onglet Employés -->
    <div class="tab-pane fade" id="employe" role="tabpanel">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="fas fa-users"></i> Décharges des Employés</h5>
        </div>
        <div class="card-body p-0">
          {% include 'decharges/decharge_table.html' with decharges=decharges_employe table_id='employeTable' show_type='employe' %}
        </div>
      </div>
    </div>

    <!-- Onglet Autres -->
    <div class="tab-pane fade" id="autre" role="tabpanel">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="fas fa-user"></i> Autres Décharges</h5>
        </div>
        <div class="card-body p-0">
          {% include 'decharges/decharge_table.html' with decharges=decharges_autre table_id='autreTable' show_type='autre' %}
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}