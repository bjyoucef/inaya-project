<!-- decharges/decharge_table.html -->
<table id="{{ table_id }}" class="table table-hover mb-0">
  <thead class="table-light">
    <tr>
      <th>Nom</th>
      {% if show_type == 'medecin' %}
      <th>Médecin</th>
      {% elif show_type == 'employe' %}
      <th>ID Employé</th>
      {% endif %}
      <th>Montant</th>
      <th>Payé</th>
      <th>Restant</th>
      <th>Progression</th>
      <th>Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for decharge in decharges %}
    {% widthratio decharge.total_payments decharge.amount 100 as pct %}
    <tr>
      <td>
        <div class="d-flex align-items-center">
          {% if show_type == 'medecin' %}
          <span class="badge bg-primary me-2">M</span>
          {% elif show_type == 'employe' %}
          <span class="badge bg-success me-2">E</span>
          {% else %}
          <span class="badge bg-info me-2">A</span>
          {% endif %}
          {{ decharge.name }}
        </div>
      </td>
      {% if show_type == 'medecin' %}
      <td>
        {% if decharge.medecin %}
        <span class="text-primary">{{ decharge.medecin.nom }} {{ decharge.medecin.prenom }}</span>
        {% else %}
        <span class="text-muted">-</span>
        {% endif %}
      </td>
      {% elif show_type == 'employe' %}
      <td>
        {% if decharge.id_employe %}
        <span class="badge bg-secondary">{{ decharge.id_employe }}</span>
        {% else %}
        <span class="text-muted">-</span>
        {% endif %}
      </td>
      {% endif %}
      <td class="fw-bold">{{ decharge.amount|floatformat:2 }} DA</td>
      <td class="text-success">{{ decharge.total_payments|floatformat:2 }} DA</td>
      <td class="fw-bold text-danger">{{ decharge.balance|floatformat:2 }} DA</td>
      <td style="min-width: 120px;">
        <div class="progress" style="height: 10px;">
          <div class="progress-bar 
            {% if show_type == 'medecin' %}bg-primary
            {% elif show_type == 'employe' %}bg-success
            {% else %}bg-info
            {% endif %}" 
            role="progressbar" 
            style="width: {{ pct }}%;" 
            aria-valuenow="{{ pct }}" 
            aria-valuemin="0" 
            aria-valuemax="100">
          </div>
        </div>
        <small class="text-muted d-block text-center mt-1">{{ pct|floatformat:0 }}%</small>
      </td>
      <td>
        <span class="badge bg-light text-dark">{{ decharge.date|date:"d/m/Y" }}</span>
      </td>
      <td>
        <div class="btn-group" role="group">
          <a href="{% url 'decharge_detail' decharge.pk %}" 
             class="btn btn-sm btn-outline-info" 
             title="Détails" 
             data-bs-toggle="tooltip">
            <i class="fas fa-eye"></i>
          </a>
          <a href="{% url 'decharge_edit' decharge.pk %}" 
             class="btn btn-sm btn-outline-warning" 
             title="Modifier" 
             data-bs-toggle="tooltip">
            <i class="fas fa-edit"></i>
          </a>
          <a href="{% url 'decharge_delete' decharge.pk %}" 
             class="btn btn-sm btn-outline-danger" 
             title="Supprimer" 
             data-bs-toggle="tooltip"
             onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette décharge ?')">
            <i class="fas fa-trash"></i>
          </a>
          <div class="btn-group" role="group">
            <button type="button" 
                    class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                    data-bs-toggle="dropdown" 
                    title="Plus d'actions">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item" href="{% url 'export_decharge_pdf' decharge.pk %}">
                  <i class="fas fa-file-pdf text-danger"></i> Exporter PDF
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="{% url 'print_decharge' decharge.pk %}" target="_blank">
                  <i class="fas fa-print text-success"></i> Imprimer
                </a>
              </li>
            </ul>
          </div>
        </div>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="{% if show_type == 'medecin' or show_type == 'employe' %}8{% else %}7{% endif %}" 
          class="text-center py-4">
        <div class="text-muted">
          <i class="fas fa-inbox fa-2x mb-2"></i>
          <p>Aucune décharge 
            {% if show_type == 'medecin' %}de médecin
            {% elif show_type == 'employe' %}d'employé
            {% else %}autre
            {% endif %} en cours
          </p>
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
// Initialiser les tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>