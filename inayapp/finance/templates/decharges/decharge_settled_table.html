<!-- decharges/decharge_settled_table.html -->
<table id="{{ table_id }}" class="table table-hover mb-0">
    <thead class="table-dark">
        <tr>
            <th>Nom</th>
            {% if show_type == 'medecin' %}
            <th>Médecin</th>
            {% elif show_type == 'employe' %}
            <th>ID Employé</th>
            {% endif %}
            <th>Montant Total</th>
            <th>Total Payé</th>
            <th>Statut</th>
            <th>Date</th>
            <th>Créé par</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for decharge in decharges %}
        <tr>
            <td>
                <div class="d-flex align-items-center">
                    {% if show_type == 'medecin' %}
                    <span class="badge bg-primary me-2">M</span>
                    {% elif show_type == 'employe' %}
                    <span class="badge bg-success me-2">E</span>
                    {% else %}
                    <span class="badge bg-info me-2">A</span>
                    {% endif %}
                    <strong>{{ decharge.name }}</strong>
                </div>
            </td>
            {% if show_type == 'medecin' %}
            <td>
                {% if decharge.medecin %}
                <div class="text-primary">
                    <i class="fas fa-user-md"></i>
                    {{ decharge.medecin.nom }} {{ decharge.medecin.prenom }}
                </div>
                {% else %}
                <span class="text-muted">-</span>
                {% endif %}
            </td>
            {% elif show_type == 'employe' %}
            <td>
                {% if decharge.id_employe %}
                <span class="badge bg-secondary">
                    <i class="fas fa-id-badge"></i> {{ decharge.id_employe }}
                </span>
                {% else %}
                <span class="text-muted">-</span>
                {% endif %}
            </td>
            {% endif %}
            <td class="fw-bold">
                <span class="text-primary">{{ decharge.amount|floatformat:2 }} DA</span>
            </td>
            <td class="fw-bold">
                <span class="text-success">{{ decharge.total_payments|floatformat:2 }} DA</span>
            </td>
            <td>
                <span class="badge bg-success fs-6">
                    <i class="fas fa-check-circle"></i> Réglée
                </span>
            </td>
            <td>
                <span class="badge bg-light text-dark">
                    <i class="fas fa-calendar-alt"></i> {{ decharge.date|date:"d/m/Y" }}
                </span>
            </td>
            <td>
                {% if decharge.id_created_par %}
                <div class="text-muted">
                    <i class="fas fa-user"></i>
                    {{ decharge.id_created_par.get_full_name|default:decharge.id_created_par.username }}
                </div>
                {% else %}
                <span class="text-muted">-</span>
                {% endif %}
            </td>
            <td>
                <div class="btn-group" role="group">
                    <a href="{% url 'decharge_detail' decharge.pk %}" 
                       class="btn btn-sm btn-outline-info" 
                       title="Voir les détails" 
                       data-bs-toggle="tooltip">
                        <i class="fas fa-eye"></i>
                    </a>
                    
                    <!-- Menu déroulant pour actions supplémentaires -->
                    <div class="btn-group" role="group">
                        <button type="button" 
                                class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                                data-bs-toggle="dropdown" 
                                title="Plus d'actions">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" href="{% url 'export_decharge_pdf' decharge.pk %}">
                                    <i class="fas fa-file-pdf text-danger"></i> Exporter PDF
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'print_decharge' decharge.pk %}" target="_blank">
                                    <i class="fas fa-print text-success"></i> Imprimer
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item text-muted" href="#" onclick="return false;">
                                    <i class="fas fa-info-circle"></i> Déjà réglée
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="{% if show_type == 'medecin' or show_type == 'employe' %}8{% else %}7{% endif %}" 
                class="text-center py-4">
                <div class="text-muted">
                    <i class="fas fa-check-circle fa-2x mb-2 text-success"></i>
                    <p class="mb-0">Aucune décharge 
                        {% if show_type == 'medecin' %}de médecin
                        {% elif show_type == 'employe' %}d'employé
                        {% else %}autre
                        {% endif %} réglée
                    </p>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
    {% if decharges %}
    <tfoot class="table-light">
        <tr class="fw-bold">
            <td{% if show_type == 'medecin' or show_type == 'employe' %} colspan="2"{% endif %}>
                <i class="fas fa-calculator"></i> Total 
                {% if show_type == 'medecin' %}Médecins
                {% elif show_type == 'employe' %}Employés
                {% else %}Autres
                {% endif %}
            </td>
            <td class="text-primary">
                {% if show_type == 'medecin' %}
                {{ total_amount_medecin|floatformat:2 }} DA
                {% elif show_type == 'employe' %}
                {{ total_amount_employe|floatformat:2 }} DA
                {% else %}
                {{ total_amount_autre|floatformat:2 }} DA
                {% endif %}
            </td>
            <td class="text-success">
                {% if show_type == 'medecin' %}
                {{ total_payments_medecin|floatformat:2 }} DA
                {% elif show_type == 'employe' %}
                {{ total_payments_employe|floatformat:2 }} DA
                {% else %}
                {{ total_payments_autre|floatformat:2 }} DA
                {% endif %}
            </td>
            <td colspan="4" class="text-center text-muted">
                {{ decharges|length }} décharge{{ decharges|length|pluralize }}
            </td>
        </tr>
    </tfoot>
    {% endif %}
</table>

<script>
// Initialiser les tooltips pour ce tableau
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('#{{ table_id }} [data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>