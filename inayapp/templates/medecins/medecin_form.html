{% extends 'layout.html' %}
{% load static %}


{% block content %}
<link rel="stylesheet" href="{% static 'css/choices.min.css' %}">

<div class="container py-2">
  <div class="card shadow-lg border-0">
    <div class="card-header bg-primary text-white py-3">
      <h2 class="h4 mb-0">
        <i class="fas fa-user-md me-2"></i>
        {% if object %}Modifier{% else %}Ajouter{% endif %} un médecin
      </h2>
    </div>
    <div class="card-body p-4">
      <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        {% csrf_token %}

        <!-- Erreurs globales -->
        {% if form.non_field_errors %}
          <div class="alert alert-danger">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <div class="row g-3">
          <div class="col-md-6">
            <!-- Personnel -->
            <div class="mb-3">
              <label class="form-label fw-bold">Personnel</label>
              {% if object %}
                <input type="text" class="form-control" value="{{ object.personnel }}" disabled>
              {% else %}
                {{ form.personnel }}
                {% for err in form.personnel.errors %}
                  <div class="invalid-feedback d-block">{{ err }}</div>
                {% endfor %}
              {% endif %}
            </div>

            <!-- Spécialité -->
            <div class="mb-3">
              <label class="form-label fw-bold">Spécialité</label>
              {{ form.specialite }}
              {% for err in form.specialite.errors %}
                <div class="invalid-feedback d-block">{{ err }}</div>
              {% endfor %}
            </div>

            <!-- Numéro d'ordre -->
            <div class="mb-3">
              <label class="form-label fw-bold">Numéro d'ordre</label>
              {{ form.numero_ordre }}
              {% for err in form.numero_ordre.errors %}
                <div class="invalid-feedback d-block">{{ err }}</div>
              {% endfor %}
            </div>
          </div>

          <div class="col-md-6">
            <!-- Services -->
            <div class="mb-3">
              <label class="form-label fw-bold">Services</label>
              {{ form.services }}
              {% for err in form.services.errors %}
                <div class="invalid-feedback d-block">{{ err }}</div>
              {% endfor %}
            </div>

            <!-- Photo de profil -->
            <div class="mb-3">
              <label class="form-label fw-bold">Photo de profil</label>
              {% if object.photo_profil %}
                <img src="{{ object.photo_profil.url }}" class="img-thumbnail mb-2" style="max-width: 150px;">
              {% endif %}
              {{ form.photo_profil }}
              {% for err in form.photo_profil.errors %}
                <div class="invalid-feedback d-block">{{ err }}</div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- Disponible -->
        <div class="form-check form-switch mb-4">
          {{ form.disponible }}
          <label class="form-check-label fw-bold">Disponible immédiatement</label>
        </div>

        <div class="d-flex justify-content-end gap-2">
          <a href="{% url 'medecins:list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-times me-2"></i>Annuler
          </a>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>Enregistrer
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="{% static 'js/choices.min.js' %}"></script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.choices-multiple').forEach(el => {
      new Choices(el, {
        removeItemButton: true,
        placeholderValue: el.getAttribute('data-placeholder'),
        searchPlaceholderValue: 'Recherche…',
        noResultsText: 'Aucun résultat trouvé',
        itemSelectText: '',
        shouldSort: false,
      });
    });
  });
</script>
{% endblock %}