{% extends "layout.html" %}

{% block content %}
<style>
    .badge {
        font-size: 0.9em;
        padding: 0.5em 0.75em;
    }

    .btn-group .btn {
        padding: 0.25rem 0.5rem;
        margin: 0 2px;
    }

    .disabled {
        opacity: 0.5;
        pointer-events: none;
    }
</style>

<div class="container mt-4">
    <h2>Gestion des Conventions</h2>

    <!-- Filter Form -->
    <form method="get" class="mb-4">
        <div class="row g-3">
            <!-- Status Filter -->
            <div class="col-md-3">
                <label for="status" class="form-label">Statut</label>
                <select class="form-select" id="status" name="status">
                    <option value="">Tous</option>
                    <option value="en_attente" {% if current_status=='en_attente' %}selected{% endif %}>En attente
                    </option>
                    <option value="accorde" {% if current_status=='accorde' %}selected{% endif %}>Accordé</option>
                    <option value="non_accorde" {% if current_status=='non_accorde' %}selected{% endif %}>Non Accordé
                    </option>
                </select>
            </div>

            <!-- Date Filters -->
            <div class="col-md-3">
                <label for="date_from" class="form-label">Date de début</label>
                <input type="date" class="form-control" id="date_from" name="date_from" value="{{ current_date_from }}">
            </div>
            <div class="col-md-3">
                <label for="date_to" class="form-label">Date de fin</label>
                <input type="date" class="form-control" id="date_to" name="date_to" value="{{ current_date_to }}">
            </div>

            <!-- Medecin Filter -->
            <div class="col-md-3">
                <label for="medecin" class="form-label">Médecin</label>
                <select class="form-select" id="medecin" name="medecin">
                    <option value="">Tous</option>
                    {% for medecin in medecins %}
                    <option value="{{ medecin.id }}" {% if current_medecin==medecin.id|stringformat:"s" %}selected{%
                        endif %}>
                        {{ medecin.nom }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Patient Filter -->
            <div class="col-md-3">
                <label for="patient" class="form-label">Patient</label>
                <select class="form-select" id="patient" name="patient">
                    <option value="">Tous</option>
                    {% for patient in patients %}
                    <option value="{{ patient.id }}" {% if current_patient==patient.id|stringformat:"s" %}selected{%
                        endif %}>
                        {{ patient.nom }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Form Buttons -->
            <div class="col-md-12">
                <button type="submit" class="btn btn-primary">Filtrer</button>
                <a href="{% url 'medical:gestion_convention_accorde' %}" class="btn btn-secondary">Réinitialiser</a>
            </div>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <!-- Table content remains the same -->
            <thead class="thead-dark">
                <tr>
                    <th>Patient</th>
                    <th>Acte</th>
                    <th>Convention</th>
                    <th>Tarif</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for pa in prestation_actes %}
                <tr>
                    <td>{{ pa.prestation.patient }}</td>
                    <td>{{ pa.acte.libelle }}</td>
                    <td>{{ pa.convention.nom|default:"-" }}</td>
                    <td>{{ pa.tarif_conventionne }} DA</td>
                    <td>
                        {% if pa.convention_accordee is None %}
                        <span class="badge bg-secondary">En attente</span>
                        {% elif pa.convention_accordee %}
                        <span class="badge bg-success">Accordé</span>
                        {% else %}
                        <span class="badge bg-danger">Non Accordé</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-group">
                            <!-- Action buttons remain the same -->
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center">Aucune convention à traiter</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}